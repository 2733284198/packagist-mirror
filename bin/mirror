#!/usr/bin/env php
<?php

declare(strict_types=1);

/*
 * This file is part of the Packagist Mirror.
 *
 * For the full license information, please view the LICENSE.md
 * file that was distributed with this source code.
 */

$autoload = __DIR__ . '/../vendor/autoload.php';
if (!file_exists($autoload)) {
    die(
        'You need to set up the project dependencies '.
        'using the following commands:' . PHP_EOL .
        'wget http://getcomposer.org/composer.phar' . PHP_EOL .
        'php composer.phar install' . PHP_EOL
    );
}

require $autoload;

// Prepare using default .env
if (!file_exists(__DIR__ . '/../.env')) {
    copy('.env.example', '.env');
}

// Load env
$dotenv = new Dotenv\Dotenv(__DIR__.'/../');
$dotenv->load();

// Using Sebastian version formatter
$version = new SebastianBergmann\Version(
    getenv('APP_VERSION'),
    __DIR__.'/../'
);

$cli = new Symfony\Component\Console\Application(
    getenv('APP_NAME'),
    $version->getVersion()
);

$cli->add(new League\Mirror\Command\Create);

// if is public snapshot option is on
if(getenv('MIRROR_PUBLIC')){
    $cli->add(new League\Mirror\Command\Snapshot);
}

$cli->run();
